# コンポーネントを作る

## Reactアプリケーションを起動する

まず、`yarn start`を実行してみます。
この時自動でブラウザが自動で立ち上がり、アプリケーションの初期ページが表示されると思います。

![yarn startした時のReact Applicationの画像](images/react-first.png)

次に`yarn build`を実行してみましょう。デフォルトではbuildと言うディレクトリに複数のディレクトリとファイルが生成されるはずです。

ここで`public/index.html`と生成された`build/index.html`を見比べてみましょう。新たに生成された`build/index.html`にはファイルが一行に圧縮されているのに加え、javascriptのコードが書かれたscriptタグが挿入されているのがわかるかと思います。開発用のコードは主にユーザーに提供する前に

- ユーザーのブラウザやマシンで読みとれる形式にする
- コードやファイルを圧縮する
- コードを難読化する(Script言語はソースコードが利用するユーザーに見えるので変数名や、処理順序が分かりにくいようにする。変数名を1文字にするなどの情報圧縮の副産物的な側面があるので、完全にリバースエンジニアリングが(困難だとしても)不可能でないことには注意しましょう。)
- 使われてないコードを除去する

などと言った過程を踏むようにbuildという作業を行います。buildに含まれる作業はツールによって様々で、詳しいbuildの内容を知りたい場合は利用しているフレームワークについて調べてください。

このCreate React Appで作成されたアプリケーションをユーザーに提供する場合は、このbuildディレクトリ配下のファイル全てを、インターネットを介してhttpまたはhttpsプロトコルでpublicにアクセス可能なホスティングサーバのストレージに配置し、ユーザーのブラウザやhttpクライアントでアクセスしてもらう形で提供することができます。

例えばFirebase HostingやAmazon Amplify, S3,Netlify、Vercelなどのcloudサービスを利用してホスティングすることが可能です。

## Reactのエントリポイントを確認してみる

ここでindex.tsxの中身を見てみると処理のようなコードが見つかると思います。


```tsx:index.tsx
ReactDOM.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
  document.getElementById("root")
);
```

[React.StrictMode](https://ja.reactjs.org/docs/strict-mode.html)の詳細についてはリンク先の記事も参考にしてください。

ReactはVirtual DOM（仮想DOM）と呼ばれる仕組みによって、HTMLのDOMを内包した仮想的なDOMをJavascriptのデータ構造としてメモリに保存し、指定したタグを起点にして内包しているDOMによって書き換えます。上記の例ではrootというidがついたタグを第一引数で表されるReact Componentに書き換える処理を実行するコードになっています。この処理のようにReactのVirtual DOMが内包しているDOMでHTMLを書き換える事をrenderあるいはレンダリングと呼びます。

この時一度レンダリングされたDOMに対してHTMLのユーザー操作により変更が加えられた時、あるいは、JavascriptからVirtual DOMが持っているパラメータに変更が加えられた時に、Virtual DOMはその差分が生じた部分を検出（Reconcilation）し、HTMLを再レンダリングします。このVirtual DOMが差分検出のために用いるデータオブジェクトをFacebookはfiberと名付け、Reconcilationを行う処理エンジンをFiberと名付け開発しています。FiberやReconcilationの仕組みを詳しく知りたい方は[こちらのリンク](https://ja.reactjs.org/docs/faq-internals.html)を参照してください。

Reactはまた、仮想DOMの中に仮想DOMを階層的に構築することが可能です。それを模しているのが以下の図です。

![Reactのコンポーンネントツリー画像](images/render-tree.png)

[引用元](https://medium.com/@coolram2104/digging-deeper-inside-the-reconciliation-algorithm-of-react-f0d428ba4ae9)

この上記の図のノード、あるいは部分的に木構造を切り出した時にルートにあたるノードが構成するツリーの事をコンポーネントと呼びます。部分木の事をコンポーネントと呼ぶ事に関して違和感を感じる人は、一つの仮想DOMを階層的に出来るということはその逆の木構造になっている仮想DOMを一つの仮想DOMにまとめることが出来るという事実を踏まえて、ノードと部分木が等価に変換可能であるという事を意識するとよいです。

どの大きさの仮想DOMをコンポーネントとして扱うかはユーザーの裁量に委ねられています。しかし、ある程度巨大な仮想DOMは開発中に管理がしにくくなる他、ReactにはReconcilationが行われるコンポーネントを最小限にすることでユーザーのブラウザ上でのアプリケーションの処理速度を向上できるため、一般的には、出来るだけ細かく分割することが推奨されており、また、[ウォーターフォール](https://ja.reactjs.org/docs/concurrent-mode-suspense.html#approach-1-fetch-on-render-not-using-suspense)と呼ばれるコンポーネントの読み込み時間が直列になってしまう現象を防ぐために、出来るだけツリーのNodeを浅くするようにコンポーネントを構成するのがよいです。。

後半の章で説明しますが、効率的にコンポーネントツリーを構築するためのデザイン指針として、[アトミックデザイン](https://bradfrost.com/blog/post/atomic-web-design/)というものがあり、多くの組織で採用されていますが、ルール上の定義は曖昧な部分がありReactに導入する場合には運用上の注意、トレードオフ、メリット、デメリットが存在するので、それらを理解した上で、自分達のプロジェクトで取り入れるべきか、また、どういう運用にするべきかを判断するようにしてください。

上記のAppコンポーネントはページ上の全て機能を階層的な仮想DOMに内包しており、仮想DOMの状態遷移によってユーザーの見ているページを動かしてい九という仕組みになっています。

このように、ある１つの仮想DOMにURL遷移を含むユーザーにインタラクションする全ての機能を盛り込んで提供することが可能で、このような方法で提供されるアプリケーションをSPA(Single Page Application)と呼びます。


## Reactアプリケーションの表示内容を変更する
